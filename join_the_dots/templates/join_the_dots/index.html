{% extends "base.html" %}
{% load staticfiles %}

{% block title %} HCC Workshop | Join the dots {% endblock %}
{% block head %} 
    <link rel="stylesheet" href="{% static 'join_the_dots/styles.css' %}">
{% endblock %}

{% block app-title %}Join the dots{% endblock %}

{% block app-breadcrumbs %}
	<li class="active">Join the dots</li>
{% endblock %}

{% block content %} 
	<div class="background-gif"></div>
	<div class="jumbotron text-center app-splash">
		<h1 class="vertical-align animated bounceInLeft">Join the dots... with your eyes!</h1>
	</div>
	
    {% if False %}
    <div class="container-fluid " >
        <p class="text-justify">Unfortunately, no eye tracker has been detected, if you have an EyeTribe connected, check the connection through the EyeTribe software and reload this page. If you do not have an EyeTribe connected to this computer please either move to a computer with one connected, of connect one. </p>
        <p class="text-justify">If you are interested in finding out more about the EyeTribe eye tracker please visit the EyeTribe's website: theeyetribe.com </p>
        <p class="text-justify">If you're interested in finding out more about eye tracking you can read the <a href="{% url 'home:eyegazeinfo' %}">information page</a> on eye tracking. </p>
        <div class="container-fluid next-page text-center">
            <a href="{% url 'home:dashboard' %}" role="button" class="btn btn-primary btn-lg">
                <i class="fa fa-home" aria-hidden="true"></i>
                <span class="next-btn-primary-span">Dashboard</span>
            </a>
        </div>
    </div>
    {% else %}
    <!--<div class="container-fluid " >-->
        <div id="intro">
            <p class="text-justify">An eye tracker is a device that captures where you are looking. It has a lot of applications in human centred computing research and practice. One use is to simply record eye gaze to see where a user has looked. In this activity we will show you what this looks like by getting you to join the dots - but with your eyes!</p> 
            <p class="text-justify">A dot will flash in different areas of the screen, just look at the dot when it appears. After this your eye gaze will be plotted over the top of the dots and you'll find out the secret word.</p>
            <section class="text-center button-section" id="experiment-button">
                <a id="start" href="#experiment" role="button" class="btn btn-primary btn-lg"><span>Try it out</span><br><i class="fa fa-chevron-down" aria-hidden="true"></i></a>
            </section>
        </div>
          
        <div id="experiment" class="container">
            <div id="map"></div>
        
            <form method="post" action="">
                {% csrf_token %}
                {{ form.gazedata.as_hidden }}
                <div class="container-fluid next-page text-center">
                <button type="submit" id="next" value="Next" class="btn btn-primary btn-lg"><span class="btn-primary-span">Next</span> <i class="fa fa-chevron-right" aria-hidden="true"></i></button>
                </div>
            </form>
            <p></p>
        <!--</div>-->
	{% endif %}

{% endblock %}

{% block script %} 
	<script type="text/javascript" src="{% static 'reading_tracking/scroll.js' %}"></script>
    <script>
    var nodes = [{"x": screen.width*0.05, "y": screen.height*0.05}, {"x": screen.width*0.05,"y": screen.height*0.5}, 
                {"x": screen.width*0.05,"y": screen.height*0.25}, {"x": screen.width*0.25,"y": screen.height*0.25}, 
                {"x": screen.width*0.25,"y": screen.height*0.05}, {"x": screen.width*0.25,"y": screen.height*0.5}, 
                {"x": screen.width*0.55,"y": screen.height*0.5}, {"x": screen.width*0.47,"y": screen.height*0.5}, 
                {"x": screen.width*0.375,"y": screen.height*0.4}, {"x": screen.width*0.33,"y": screen.height*0.25}, 
                {"x": screen.width*0.375,"y": screen.height*0.11}, {"x": screen.width*0.47,"y": screen.height*0.05}, 
                {"x": screen.width*0.55,"y": screen.height*0.05}, 
                {"x": screen.width*0.87,"y": screen.height*0.05}, {"x": screen.width*0.8,"y": screen.height*0.05},
                {"x": screen.width*0.7,"y": screen.height*0.11}, {"x": screen.width*0.65,"y": screen.height*0.25}, 
                {"x": screen.width*0.7,"y": screen.height*0.4}, {"x":screen.width*0.8,"y": screen.height*0.5}, 
                {"x": screen.width*0.87,"y": screen.height*0.5},
                {"x": -100,"y": -100}]

    var eyedata = [];
    etdata = $('#id_gazedata');
    $('#start').click(function() {
        console.log("now collecting");
        EyeTribe.loop(function(frame) {
                eyedata.push(frame.dump());
                etdata.val(JSON.stringify(eyedata));
            });
            
        var svg = d3.select("#map").append("svg")
                    .attr("width", "90vw")
                    .attr("height", "70vh");
        nodes.forEach(function(d, i) {
            setTimeout(function() {
                var existing = d3.selectAll(".node")
                    .attr("fill", "white")
                svg.append("circle")
                    .datum(d)
                    .attr("class", "node")
                    .attr("cx", function(d) {
                        return d.x;
                    })
                    .attr("cy", function(d) {
                        return d.y;
                    })                 
                    .attr("r", "10");               
            }, 1500 * i);
        });
    });
</script>
{% endblock %}